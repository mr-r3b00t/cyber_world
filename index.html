<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Real-Time Global Cyber Attacks</title>
  <script src="https://unpkg.com/globe.gl"></script>
  <style>
    body { margin:0; overflow:hidden; background:#000; font-family: 'Segoe UI', sans-serif; }
    #globe-container { width:100vw; height:100vh; }
    #title {
      position:absolute; top:20px; left:50%; transform:translateX(-50%);
      color:#00ffcc; font-size:2.8rem; text-shadow:0 0 25px #00ffcc;
      z-index:10; pointer-events:none; letter-spacing:3px;
    }
    #stats {
      position:absolute; bottom:20px; left:20px;
      background:rgba(0,0,0,0.8); padding:18px 30px; border-radius:15px;
      border:2px solid #00ff88; color:#00ffcc; z-index:10; font-size:1.3rem;
      box-shadow:0 0 20px rgba(0,255,200,0.3);
    }
    .stat { margin:10px 0; }
  </style>
</head>
<body>
  <div id="title">GLOBAL CYBER ATTACKS LIVE</div>
  <div id="stats">
    <div class="stat">Attacks visualized: <span id="count">0</span></div>
    <div class="stat">Source: honeypot.json</div>
  </div>
  <div id="globe-container"></div>

  <script>
    const globe = Globe()
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
      .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
      .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
      .atmosphereColor('#00ffff')
      .atmosphereAltitude(0.18)
      .pointOfView({ lat: 15, lng: 0, altitude: 2.5 })
      (document.getElementById('globe-container'));

    let attacks = [];
    let totalAttacks = 0;

    // Load attacks from local honeypot.json
    async function loadAttacks() {
      try {
        const response = await fetch('honeypot.json');
        if (!response.ok) throw new Error('File not found');
        const data = await response.json();

        // Clear old arcs
        attacks = [];

        data.forEach(attack => {
          const srcLat = attack.src_lat || attack.latitude || attack.src_latitude;
          const srcLng = attack.src_lon || attack.longitude || attack.src_longitude;
          const dstLat = attack.dst_lat || attack.dst_latitude || 50.11;   // fallback: Europe (honeypot location)
          const dstLng = attack.dst_lon || attack.dst_longitude || 8.68;

          if (!srcLat || !srcLng) return;

          attacks.push({
            startLat: srcLat + rand(-3, 3),
            startLng: srcLng + rand(-5, 5),
            endLat: dstLat,
            endLng: dstLng,
            color: ['#ff0066', '#00ffcc'],
            stroke: 1.5 + Math.random() * 2.5,
            dashAnimateTime: 1500 + Math.random() * 3000
          });
        });

        totalAttacks = attacks.length;
        document.getElementById('count').textContent = totalAttacks.toLocaleString();

        renderAttacks();

      } catch (err) {
        console.error("Could not load honeypot.json:", err);
        document.getElementById('stats').innerHTML += '<br><span style="color:#ff0066">honeypot.json not found!</span>';
      }
    }

    function renderAttacks() {
      globe.arcsData(attacks)
        .arcColor('color')
        .arcStroke('stroke')
        .arcDashLength(0.9)
        .arcDashGap(4)
        .arcDashInitialGap(() => Math.random() * 5)
        .arcDashAnimateTime('dashAnimateTime');

      const points = attacks.flatMap(a => [
        { lat: a.startLat, lng: a.startLng, size: 0.6, color: '#ff3366' },
        { lat: a.endLat,   lng: a.endLng,   size: 1.0, color: '#00ffff' }
      ]);

      globe.pointsData(points)
        .pointAltitude(0.015)
        .pointRadius('size')
        .pointColor('color');
    }

    function rand(min, max) { return Math.random() * (max - min) + min; }

    // Auto-rotate
    globe.controls().autoRotate = true;
    globe.controls().autoRotateSpeed = 0.5;

    // Load on start
    loadAttacks();

    // Optional: Reload every 30 seconds if you update the JSON file
    // setInterval(loadAttacks, 30000);
  </script>
</body>
</html>
